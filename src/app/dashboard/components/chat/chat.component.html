<!-- Chatbox Button (fixed to the bottom right) -->
<button
  (click)="toggleChat()"
  pButton
  icon="pi pi-comment"
  class="chat-toggle-btn"
  pTooltip="المساعدة"
  tooltipPosition="top"
></button>

<!-- Chatbox Container (fixed to the bottom right) -->
<p-panel
  *ngIf="chatVisible"
  [style]="{ width: '500px' }"
  [collapsed]="false"
  [styleClass]="isFullscreen ? 'fullscreen' : ''"
  class="chat-box"
  [styleClass]="'rtl-chatbox'"
>
  <ng-template pTemplate="header">
    <span>AI المساعد الذكي</span>
    <button
      pButton
      icon="pi pi-window-maximize"
      class="fullscreen-btn"
      (click)="toggleFullscreen()"
      tooltip="التبديل إلى وضع ملء الشاشة"
    ></button>
  </ng-template>

  <div class="chat-body">
    <p>كيف يمكنني مساعدتك اليوم؟</p>

    <!-- Chat Messages -->
    <div class="chat-messages">
      <div
        #Answer
        *ngFor="let message of messages"
        [ngClass]="{
          'user-message': message.isUser,
          'bot-message': !message.isUser
        }"
      >
        {{ message.text }}
        <div *ngIf="isLoading" class="loading-dots">
          <span>.</span><span>.</span><span>.</span>
        </div>
      </div>
    </div>

    <!-- Chat Input Area -->
    <div class="chat-input">
      <input
        [(ngModel)]="userMessage"
        type="text"
        placeholder="اكتب رسالتك..."
        (keydown.enter)="sendMessage()"
      />
      <button
        class="flex-grow-1"
        pButton
        icon="pi pi-send"
        label="إرسال"
        (click)="sendMessage()"
      ></button>
    </div>
  </div>
</p-panel>
