<p-card header="إضافة موضوع جديد" class="p-mb-3">
  <p-toast />
  <form [formGroup]="addArticleForm" (ngSubmit)="approveBlog()">
    <div class="row g-3">
      <!-- Image Upload with Drag and Drop -->
      <div class="col-12">
        <div>
          <div class="p-field mb-3">
            <p-fileUpload
              #fileUpload
              name="post_image"
              accept="image/*"
              [auto]="true"
              [chooseLabel]="'اختر صورة'"
              [uploadLabel]="'رفع'"
              [cancelLabel]="'إلغاء'"
              [showUploadButton]="true"
              [showCancelButton]="true"
              [customUpload]="true"
              (onSelect)="onFileSelect($event)"
              [draggable]="true"
            >
            </p-fileUpload>
          </div>
        </div>
      </div>

      <!-- Category MultiSelect -->
      <div class="col-12">
        <div class="p-field">
          <p-multiSelect
            [options]="categories"
            styleClass="w-100"
            formControlName="categories"
            optionLabel="label"
            placeholder="اختر الفئات"
            [filter]="true"
            appendTo="body"
            display="chip"
            [maxSelectedLabels]="10"
          ></p-multiSelect>
        </div>
      </div>

      <!-- Title Input -->
      <div class="col-12">
        <div class="p-field">
          <input
            #post_title
            id="post_title"
            type="text"
            pInputText
            formControlName="post_title"
            placeholder="أدخل عنوان المقال"
            class="p-inputtext-lg"
          />
          <div class="d-flex justify-content-between align-items-center">
            <small>
              <small
                class="p-error"
                *ngIf="
                  addArticleForm.get('post_title')?.hasError('seoTitle') &&
                  addArticleForm.get('post_title')?.touched
                "
              >
                {{ addArticleForm.get("post_title")?.getError("seoTitle") }}
              </small>
            </small>
            <small
              [ngClass]="{
                'p-error':
                  addArticleForm.get('post_title')?.hasError('seoTitle') &&
                  addArticleForm.get('post_title')?.touched
              }"
              >{{ post_title.value.length }}/60</small
            >
          </div>
        </div>
      </div>

      <!-- Author Dropdown -->
      <div class="col-6">
        <div class="p-field">
          <p-dropdown
            [options]="authors"
            formControlName="author_name"
            placeholder="اختر اسم الكاتب"
            [filter]="true"
            optionLabel="label"
            optionValue="value"
            appendTo="body"
            styleClass="w-full"
          ></p-dropdown>
        </div>
      </div>

      <!-- Date Input -->
      <div class="col-6">
        <div class="position-relative">
          <p-calendar
            formControlName="post_date"
            (onSelect)="onDateSelect($event)"
            [dateFormat]="'yy-mm-dd'"
            [showIcon]="true"
            styleClass="w-full"
            placeholder="اختر تاريخ المقال"
          ></p-calendar>
        </div>
      </div>

      <!-- Content Editor -->
      <div class="col-12">
        <div class="p-field mb-3">
          <ngx-jodit
            formControlName="post_content"
            [options]="options"
            #ngxJodit
          ></ngx-jodit>
          <small
            class="p-error"
            *ngIf="
              addArticleForm
                .get('post_content')
                ?.hasError('minContentLength') &&
              addArticleForm.get('post_content')?.touched
            "
          >
            {{
              addArticleForm.get("post_content")?.getError("minContentLength")
            }}
          </small>
          <small
            class="p-error"
            *ngIf="
              addArticleForm.get('post_content')?.hasError('invalidArabic') &&
              addArticleForm.get('post_content')?.touched
            "
          >
            {{ addArticleForm.get("post_content")?.getError("invalidArabic") }}
          </small>
        </div>
      </div>
      <!-- Submit Button -->
      <div class="p-md-6">
        <div class="p-field">
          <button
            pButton
            type="submit"
            label="نشر المقال"
            [disabled]="!addArticleForm.valid"
          ></button>
        </div>
      </div>
    </div>
  </form>
</p-card>

<!-- Confirmation Dialog for Approve -->
@if(currentBlog) {
<p-dialog
  [draggable]="false"
  [(visible)]="approveDialogVisible"
  header="تأكيد الموافقة"
  [modal]="true"
  [style]="{ maxwidth: '90vw' }"
>
  <app-privew-blog [IBlogs]="currentBlog" />
  <div>
    <span>هل أنت متأكد أنك تريد الموافقة على الموضوع؟</span>
  </div>
  <ng-template pTemplate="footer">
    <button
      pButton
      pRipple
      label="إلغاء"
      icon="pi pi-times"
      class="p-button-text"
      (click)="approveDialogVisible = false"
    ></button>
    <button
      pButton
      pRipple
      label="موافقة"
      icon="pi pi-check"
      class="p-button-text"
      (click)="onSubmit(); approveDialogVisible = false; fileUpload.clear()"
    ></button>
  </ng-template>
</p-dialog>
}

<ngx-spinner
  bdColor="rgba(255, 255, 255, 0.75)"
  size="default"
  color="var(--secondary-color-green)"
  type="ball-beat"
  [showSpinner]="false"
  [disableAnimation]="true"
  [fullScreen]="true"
>
  <span class="d-block d-block mx-auto text-center translate-middle-y"> </span
></ngx-spinner>
